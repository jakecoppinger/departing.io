function updateStopData(a){var b=$("#stopid").val();window.server.validStopID(b,function(c){c?(window.busStop=new BusStop(b,a,server),window.busStop.updateDepartures("90",function(a){window.busStop.setDepartures(a),updatedDeparturesResponse(a)})):console.log("Invalid bus route!")})}function updatedDeparturesResponse(){var b=window.busStop.updateAvailableBusRoutes();console.log(b),b.length>0?(viewAvailableBusRoutes(b),$(".loading_routes").fadeOut(function(){$(".afterloading_routes").fadeIn()}),heap.track("Viewing departures",{"Bus route ID":$("#stopid").val()})):(heap.track("No departures found",{"Bus route ID":$("#stopid").val()}),$("#loadingroutestext").text("No departures found"))}function progressToVisualisation(){$("#busrouteselect").val()?(visualisingBus=!0,updateFastestBus(),showVisualisationPage(),heap.track("Viewed bus route",{"Bus Route":$("#busrouteselect").val()})):console.log("No bus route has been selected!")}function updateFastestBus(){var a=$("#busrouteselect").val(),b=window.busStop.fastestBusOnRoute(a);window.arrivingBus=new Bus(b)}window.busStop=0,window.arrivingBus=0,console.log("Port is:"),console.log(window.hostPort),console.log("Host is:"),console.log(window.hostURL),window.server=new Backend(window.hostURL,window.hostPort),window.visualisingBus=!1,window.updatingView=!0,$(document).bind("touchmove",function(a){a.preventDefault()}),$(document).ready(function(){setTimeout(function(){$("#hidpidiv").show()},3e3),$("#about_popup").popup({opacity:.94,transition:"all 0.3s",color:"#111111"}),$("#address").autocomplete({source:function(a,b){$("#testdata").text(JSON.stringify(a.term)),$.ajax({type:"POST",url:"http://"+window.hostURL+":"+window.hostPort+"/closeststop",dataType:"json",async:!0,data:{search_term:a.term},success:function(a){b(a)}})},minLength:1,delay:300,select:function(a,b){b.item?"0000"!=b.item.id&&(console.log("Selected: "+b.item.label),console.log("Bus Stop ID is "+b.item.id),$("#stopid").val(b.item.id),updateStopData(b.item.label),$("#loadingroutestext").text("Loading bus routes..."),$(".loading_routes").fadeIn(),heap.track("Selected bus stop",{"Bus stop description":b.item.label,"Bus stop ID":b.item.id})):console.log("Nothing selected, input was "+this.value)},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}}),$("#address").focus(function(){$(document).unbind("touchmove"),console.log("We have focus")}),$("#address").focusout(function(){$(document).bind("touchmove",function(a){a.preventDefault()})})});