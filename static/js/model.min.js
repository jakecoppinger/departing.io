function Backend(a,b){this.serverHost=a,this.serverPort=b,this.currentStop="",this.currentStopDepartures=[]}function BusStop(a,b,c){this.server=c,this.stopID=a,this.addressString=b,this.stopDepartures=["???"],self.journeysOnBusRoute=[],this.availableBusRoutes=[]}function Bus(a){this.busJourneyObject=a}Backend.prototype.validStopID=function(a,b){var c="http://"+this.serverHost+":"+this.serverPort+"/validstopid";$.ajax({type:"POST",url:c,dataType:"json",async:!0,data:{stop_id:a},success:function(c){b(a,c)}})},Backend.prototype.stopDepartures=function(a,b,c){var d="http://"+this.serverHost+":"+this.serverPort+"/departures";$.ajax({type:"POST",url:d,dataType:"json",async:!0,data:{stop_id:a,preview_time:b},success:function(a){c(a)}})},BusStop.prototype.updateDepartures=function(a,b){this.server.stopDepartures(this.stopID,a,function(a){b(a)})},BusStop.prototype.setDepartures=function(a){this.stopDepartures=a},BusStop.prototype.updateAvailableBusRoutes=function(){var a=this.stopDepartures;return availableBusRoutes=[],$.each(a,function(a,b){var c=b.busRouteNumber;-1==$.inArray(c,availableBusRoutes)&&availableBusRoutes.push(c)}),this.availableBusRoutes=availableBusRoutes,availableBusRoutes},BusStop.prototype.validBusRouteSelected=function(a){return this.availableBusRoutes.indexOf(a)>-1?!0:!1},BusStop.prototype.updateJourneysOnBusRoute=function(a){var b=[];$.each(this.stopDepartures,function(c,d){d.busRouteNumber==a&&b.push(d)}),this.journeysOnBusRoute=b},BusStop.prototype.fastestBusOnRoute=function(a){this.updateJourneysOnBusRoute(a);var b=[];return moment(),$.each(this.journeysOnBusRoute,function(a,c){if(0==b.length)b=c;else{var d=moment(b.departureTime,moment.ISO_8601),e=moment(c.departureTime,moment.ISO_8601);d.diff(e)>0&&(b=c)}}),b},BusStop.prototype.address=function(){return this.addressString},Bus.prototype.departureTimestamp=function(){return this.busJourneyObject.departureTime},Bus.prototype.routeNumber=function(){return this.busJourneyObject.busRouteNumber},Bus.prototype.destination=function(){return this.busJourneyObject.destinationName},Bus.prototype.monitored=function(){return"true"==this.busJourneyObject.monitored?!0:!1},Bus.prototype._durationUntilArrival=function(){var a=moment(this.departureTimestamp(),moment.ISO_8601),b=moment();return moment.duration(a.diff(b))},Bus.prototype.minutesUntilArrival=function(){var a=this._durationUntilArrival(),b=a.minutes();return b},Bus.prototype.secondsUntilArrival=function(){var a=this._durationUntilArrival(),b=a.seconds();return b},Bus.prototype.exactSecondsUntilArrival=function(){var a=this._durationUntilArrival(),b=a.asSeconds()-60*a.minutes();return b};